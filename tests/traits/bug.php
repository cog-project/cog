<?php
trait bugTests {
	function testMatchRowsBug() {
		$data = '{"aaea85f49f6c411f95b4b95781e2eabe95e26a39":{"hash":"1a1fc09fd39ecd3e3078436b71dce2db091793006c9908cdf2a99d603af5295a","request":{"headers":{"version":"0.0.4","prevHash":"0000000000000000000000000000000000000000000000000000000000000000","timestamp":"2019-09-07 18:53:48Z","counter":"","address":"c08d67eccbad3cb0ad1d6af210ffd220e6177ea253694424fb20033c2ff4a0a6","publicKey":"-----BEGIN PUBLIC KEY-----\nMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAsT7i1a\/gA4mIHqyssiZ8\nbiyxdTtvkb1Y8jhj8dWZJuBYhqSNtWI38YvzSNkuNiAEl7SJXuZ9\/\/Q8i8rD6Ctd\ntE+GoBj8QxSTfE9FcoAwcreuGVKJk7UO\/z4zR5MnqJpUYVaijivZ9BxXNC9mg2hI\ndUBGo+mnDrp7S6cVnqBvD5mOvvghoHQb+6ME6JXEMqUeBg0NUEp9EYV5v\/IYQ4do\nLtlTuL7kWfASCKfPteaZMm47juH7hiDyRRIyh1IfUY4AXB8OprYooMm\/Tgz0i4PG\ndsqg+7DzaYpndqgG\/TAZlI4VZemP6Hvl+Zj2shMq7+4wa6gPiOoEpMOHiOpFKsrb\nvYlC+cv3JWzmImmlKZAwY7kBlzFUFKihJyU04jAOy5wvSMzwf+SwS\/3P4xssPRlN\nWwRm7jGIfbr8BS+hLP\/Rh3OKeNI3Ij180+fQkir7CB7p\/rkQI84irWIHPX+n2t3d\n0XVWg8YiyaiUX6RgvvINAyF8EODjpNwV3zL4e77JKGmEz\/StSqEiK5qzqASqWGBK\n0657Upl1F8W+jTjfjMHEmev9j2gUZzvfDVzNwsj1q1m66Dym+PuEOeM9OUDhS9Bm\nmufqAkZeWPilZYAjQnYtLuB9HtnRbdqg\/lUoYWAiN89YSSMUHTEJgoQ\/WqHu\/zvg\niC7t2aj849oZp\/559+VHoPkCAwEAAQ==\n-----END PUBLIC KEY-----\n"},"action":"contract","params":{"inputs":[{"from":"da320db16453c9487f7f4f670e8b015f857c02f60390b0171ca66414db7d4289","to":"d5cdfcf01aa9f0868e24cbfa13b8e2a49b2b4787233d7941776cedaa2128f16c","amount":10,"message":"do a barrel roll"},{"from":"da320db16453c9487f7f4f670e8b015f857c02f60390b0171ca66414db7d4289","to":"e03ab2695e4019ac61a6665f5ec67fdc70e594952f215a3fcf0c9c77ee2570a5","amount":1,"role":"arbitrator"},{"from":"da320db16453c9487f7f4f670e8b015f857c02f60390b0171ca66414db7d4289","to":"c08d67eccbad3cb0ad1d6af210ffd220e6177ea253694424fb20033c2ff4a0a6","amount":1,"role":"guarantor"}]},"environment":"cogTest"},"_id":"aaea85f49f6c411f95b4b95781e2eabe95e26a39"},"c3d1ef98943e3f85319dfb31d2f93030349e7fe4":{"hash":"d92a8f3ae0d0a811f587f241ea47643c26c41d9c717ed060499e6bb5ae6e74a7","request":{"headers":{"version":"0.0.4","prevHash":"1a1fc09fd39ecd3e3078436b71dce2db091793006c9908cdf2a99d603af5295a","timestamp":"2019-09-07 18:53:51Z","counter":"","address":"44f019da871c93b5dab0d92546a1b0b5ace6ce9bfcb4d41a0e752e245d306800","publicKey":"-----BEGIN PUBLIC KEY-----\nMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA6wx7k8NZSbT\/6pXddBp8\n1ukc3ChhRMm+s3muV7n9S2y2QwEnlgXaCqkYmwtKGNSByehiJRNnmseJTm+BEtBY\n3\/QeYxIe5AuIQVlmfo8\/vsKXpSW8K8z5aV4jgX4XHCp21Q7cwYWWPchG+s9or05f\naa9wJ0CLPkmGSc1gLdsrFAJi5dtNPouOhDGVPWe6UL9NjZTCdrBvLB1dDi62t89a\nPPPn6GGqpJZVBGf\/7Nh7bqxq4HAaC2NlH6dfXb20PNlq6h\/4WzdbqGlxirRACBBu\nV1u3vpbMPSu2ld6dHbDirldBW7LU7UqkJsik1wHsa4fTLo7GIY5hk+DMGz4YlbvH\nH7sZzbcGUrOOjNsmdEMhD3EKTl0jHQLUAhCVxJT3qnta9zkvH5AD4mbiHdlN6rYX\nSGji6XGecjVUq5TuSAAnK9x4rQpqb18SdUjhHMKUOVXUjzAq81YdnQ258X2XuK73\nhtNwp2oyqPrfyalOC9ZKSnPNqSbCpvTQswY4rCEEa4UM7ka+xt8KmH6E4AENRKF+\nVIibnIRceAYfGh7ajgqFO6AKLx0LELu5DQAqjkCLwrXAHD5alAsDljlPOn0Rqxh4\na3FoHVFKo3Dpo1OV46h77jITpzbKI7cR1KgN9o8M53hxhyvAGYhhRtbQx8XDv9N8\n8iW0LyAMgWb75MM3Sfa4FM0CAwEAAQ==\n-----END PUBLIC KEY-----\n"},"action":"addendum","params":{"inputs":[{"from":"44f019da871c93b5dab0d92546a1b0b5ace6ce9bfcb4d41a0e752e245d306800","to":"5c18c70b112cfa4912e464f587dad0615083959b05b7a8a5d7d6903fa39b65a2","amount":20,"message":"do a barrel roll","deadline":"2019-09-07 18:54:06"},{"from":"44f019da871c93b5dab0d92546a1b0b5ace6ce9bfcb4d41a0e752e245d306800","to":"25a93e39e904c551a9d9dc32c4bc9655173f68db93387dbe7794c50894382806","amount":2,"role":"arbitrator"},{"from":"44f019da871c93b5dab0d92546a1b0b5ace6ce9bfcb4d41a0e752e245d306800","to":"7c5e02f38b39d97bbe0c9db38db400d75974fb76208b539ca50722147212c582","amount":2,"role":"guarantor"}]},"environment":"cogTest"},"_id":"c3d1ef98943e3f85319dfb31d2f93030349e7fe4"}}';
		$json = json_decode($data,true);
		$key = "request.action";
		$val = "addendum";

		$flat = new flat();
		$matches = $flat->get_match_rows($json,$key);
		$flat->filter_for_key($json,$key,$val);
		$this->assertTrue(count($json) > 0);
	}
}
?>
